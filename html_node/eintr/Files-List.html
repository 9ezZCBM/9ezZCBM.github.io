<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rev="made" href="mailto:bug-gnu-emacs@gnu.org">
<link rel="icon" type="image/png" href="/graphics/gnu-head-mini.png">
<meta name="ICBM" content="42.256233,-71.006581">
<meta name="DC.title" content="gnu.org">

<title>Files List - Programming in Emacs Lisp</title>
<!--
This is an `Introduction to Programming in Emacs Lisp', for
people who are not programmers.

   Distributed with Emacs version 26.2.

   Copyright (C) 1990--1995, 1997, 2001--2019 Free Software
Foundation, Inc.



   Printed copies available from `https://shop.fsf.org/'. Published by:
     GNU Press,                        https://www.fsf.org/licensing/gnu-press/
     a division of the                 email: sales@fsf.org
     Free Software Foundation, Inc.    Tel: +1 (617) 542-5942
     51 Franklin Street, Fifth Floor   Fax: +1 (617) 542-2652
     Boston, MA 02110-1301 USA

   ISBN 1-882114-43-4

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; there being no Invariant Section, with the Front-Cover
     Texts being ``A GNU Manual'', and with the Back-Cover Texts as in
     (a) below.  A copy of the license is included in the section
     entitled ``GNU Free Documentation License''.

     (a) The FSF's Back-Cover Text is: ``You have the freedom to copy
     and modify this GNU manual.  Buying copies from the FSF supports
     it in developing GNU and promoting software freedom.''
   -->
<style type="text/css">
@import url('/software/emacs/manual.css');
</style>
</head>
<body>
<div class="node" style="background-color:#DDDDFF">
<a name="Files-List"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Counting-function-definitions.html#Counting-function-definitions">Counting function definitions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Sorting.html#Sorting">Sorting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Prepare-the-data.html#Prepare-the-data">Prepare the data</a>

</div>

<h4 class="subsection">14.9.2 Making a List of Files</h4>

<p>The <code>recursive-lengths-list-many-files</code> function requires a list
of files as its argument.  For our test examples, we constructed such
a list by hand; but the Emacs Lisp source directory is too large for
us to do for that.  Instead, we will write a function to do the job
for us.  In this function, we will use both a <code>while</code> loop and a
recursive call.

   <p><a name="index-directory_002dfiles-289"></a>We did not have to write a function like this for older versions of
GNU Emacs, since they placed all the &lsquo;<samp><span class="samp">.el</span></samp>&rsquo; files in one
directory.  Instead, we were able to use the <code>directory-files</code>
function, which lists the names of files that match a specified
pattern within a single directory.

   <p>However, recent versions of Emacs place Emacs Lisp files in
sub-directories of the top level <samp><span class="file">lisp</span></samp> directory.  This
re-arrangement eases navigation.  For example, all the mail related
files are in a <samp><span class="file">lisp</span></samp> sub-directory called <samp><span class="file">mail</span></samp>.  But at
the same time, this arrangement forces us to create a file listing
function that descends into the sub-directories.

   <p><a name="index-files_002din_002dbelow_002ddirectory-290"></a>We can create this function, called <code>files-in-below-directory</code>,
using familiar functions such as <code>car</code>, <code>nthcdr</code>, and
<code>substring</code> in conjunction with an existing function called
<code>directory-files-and-attributes</code>.  This latter function not only
lists all the filenames in a directory, including the names
of sub-directories, but also their attributes.

   <p>To restate our goal: to create a function that will enable us
to feed filenames to <code>recursive-lengths-list-many-files</code>
as a list that looks like this (but with more elements):

<pre class="smallexample">     ("./lisp/macros.el"
      "./lisp/mail/rmail.el"
      "./lisp/makesum.el")
</pre>
   <p>The <code>directory-files-and-attributes</code> function returns a list of
lists.  Each of the lists within the main list consists of 13
elements.  The first element is a string that contains the name of the
file&mdash;which, in GNU/Linux, may be a <dfn>directory file</dfn>, that is to
say, a file with the special attributes of a directory.  The second
element of the list is <code>t</code> for a directory, a string
for symbolic link (the string is the name linked to), or <code>nil</code>.

   <p>For example, the first &lsquo;<samp><span class="samp">.el</span></samp>&rsquo; file in the <samp><span class="file">lisp/</span></samp> directory
is <samp><span class="file">abbrev.el</span></samp>.  Its name is
<samp><span class="file">/usr/local/share/emacs/22.1.1/lisp/abbrev.el</span></samp> and it is not a
directory or a symbolic link.

   <p>This is how <code>directory-files-and-attributes</code> lists that file and
its attributes:

<pre class="smallexample">     ("abbrev.el"
     nil
     1
     1000
     100
     (20615 27034 579989 697000)
     (17905 55681 0 0)
     (20615 26327 734791 805000)
     13188
     "-rw-r--r--"
     t
     2971624
     773)
</pre>
   <p>On the other hand, <samp><span class="file">mail/</span></samp> is a directory within the <samp><span class="file">lisp/</span></samp>
directory.  The beginning of its listing looks like this:

<pre class="smallexample">     ("mail"
     t
     ...
     )
</pre>
   <p>(To learn about the different attributes, look at the documentation of
<code>file-attributes</code>.  Bear in mind that the <code>file-attributes</code>
function does not list the filename, so its first element is
<code>directory-files-and-attributes</code>'s second element.)

   <p>We will want our new function, <code>files-in-below-directory</code>, to
list the &lsquo;<samp><span class="samp">.el</span></samp>&rsquo; files in the directory it is told to check, and in
any directories below that directory.

   <p>This gives us a hint on how to construct
<code>files-in-below-directory</code>:  within a directory, the function
should add &lsquo;<samp><span class="samp">.el</span></samp>&rsquo; filenames to a list; and if, within a directory,
the function comes upon a sub-directory, it should go into that
sub-directory and repeat its actions.

   <p>However, we should note that every directory contains a name that
refers to itself, called <samp><span class="file">.</span></samp> (&ldquo;dot&rdquo;), and a name that refers to
its parent directory, called <samp><span class="file">..</span></samp> (&ldquo;dot dot&rdquo;).  (In
<samp><span class="file">/</span></samp>, the root directory, <samp><span class="file">..</span></samp> refers to itself, since
<samp><span class="file">/</span></samp> has no parent.)  Clearly, we do not want our
<code>files-in-below-directory</code> function to enter those directories,
since they always lead us, directly or indirectly, to the current
directory.

   <p>Consequently, our <code>files-in-below-directory</code> function must do
several tasks:

     <ul>
<li>Check to see whether it is looking at a filename that ends in
&lsquo;<samp><span class="samp">.el</span></samp>&rsquo;; and if so, add its name to a list.

     <li>Check to see whether it is looking at a filename that is the name of a
directory; and if so,

          <ul>
<li>Check to see whether it is looking at <samp><span class="file">.</span></samp>  or <samp><span class="file">..</span></samp>; and if
so skip it.

          <li>Or else, go into that directory and repeat the process. 
</ul>
     </ul>

   <p>Let's write a function definition to do these tasks.  We will use a
<code>while</code> loop to move from one filename to another within a
directory, checking what needs to be done; and we will use a recursive
call to repeat the actions on each sub-directory.  The recursive
pattern is Accumulate
(see <a href="Accumulate.html#Accumulate">Accumulate</a>),
using <code>append</code> as the combiner.

<!-- /usr/local/share/emacs/22.1.1/lisp/ -->
   <p>Here is the function:

<pre class="smallexample">     (defun files-in-below-directory (directory)
       "List the .el files in DIRECTORY and in its sub-directories."
       ;; Although the function will be used non-interactively,
       ;; it will be easier to test if we make it interactive.
       ;; The directory will have a name such as
       ;;  "/usr/local/share/emacs/22.1.1/lisp/"
       (interactive "DDirectory name: ")
       (let (el-files-list
             (current-directory-list
              (directory-files-and-attributes directory t)))
         ;; while we are in the current directory
         (while current-directory-list
           (cond
            ;; check to see whether filename ends in '.el'
            ;; and if so, add its name to a list.
            ((equal ".el" (substring (car (car current-directory-list)) -3))
             (setq el-files-list
                   (cons (car (car current-directory-list)) el-files-list)))
            ;; check whether filename is that of a directory
            ((eq t (car (cdr (car current-directory-list))))
             ;; decide whether to skip or recurse
             (if
                 (equal "."
                        (substring (car (car current-directory-list)) -1))
                 ;; then do nothing since filename is that of
                 ;;   current directory or parent, "." or ".."
                 ()
               ;; else descend into the directory and repeat the process
               (setq el-files-list
                     (append
                      (files-in-below-directory
                       (car (car current-directory-list)))
                      el-files-list)))))
           ;; move to the next filename in the list; this also
           ;; shortens the list so the while loop eventually comes to an end
           (setq current-directory-list (cdr current-directory-list)))
         ;; return the filenames
         el-files-list))
</pre>
   <!-- (files-in-below-directory "/usr/local/src/emacs/lisp/") -->
<!-- (files-in-below-directory "/usr/local/share/emacs/22.1.1/lisp/") -->
   <p>The <code>files-in-below-directory</code> <code>directory-files</code> function
takes one argument, the name of a directory.

   <p>Thus, on my system,

<!-- (length (files-in-below-directory "/usr/local/src/emacs/lisp/")) -->
<!-- !!! 22.1.1 lisp sources location here -->
<pre class="smallexample">     (length
      (files-in-below-directory "/usr/local/share/emacs/22.1.1/lisp/"))
</pre>
   <p class="noindent">tells me that in and below my Lisp sources directory are 1031
&lsquo;<samp><span class="samp">.el</span></samp>&rsquo; files.

   <p><code>files-in-below-directory</code> returns a list in reverse alphabetical
order.  An expression to sort the list in alphabetical order looks
like this:

<pre class="smallexample">     (sort
      (files-in-below-directory "/usr/local/share/emacs/22.1.1/lisp/")
      'string-lessp)
</pre>
   </body></html>

