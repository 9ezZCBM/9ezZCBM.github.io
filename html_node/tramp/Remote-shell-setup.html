<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rev="made" href="mailto:bug-gnu-emacs@gnu.org">
<link rel="icon" type="image/png" href="/graphics/gnu-head-mini.png">
<meta name="ICBM" content="42.256233,-71.006581">
<meta name="DC.title" content="gnu.org">

<title>Remote shell setup - TRAMP 2.3.4.26.2 User Manual</title>
<!--
Copyright (C) 1999--2019 Free Software Foundation, Inc.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual'', and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License''.

     (a) The FSF's Back-Cover Text is: ``You have the freedom to copy
     and modify this GNU manual.''
   -->
<style type="text/css">
@import url('/software/emacs/manual.css');
</style>
</head>
<body>
<div class="node" style="background-color:#DDDDFF">
<a name="Remote-shell-setup"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Android-shell-setup.html#Android-shell-setup">Android shell setup</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Remote-programs.html#Remote-programs">Remote programs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Configuration.html#Configuration">Configuration</a>

</div>

<h3 class="section">5.16 Remote shell setup hints</h3>

<p><a name="index-remote-shell-setup-190"></a><a name="index-g_t_0040file_007b_002eprofile_007d-file-191"></a><a name="index-g_t_0040file_007b_002elogin_007d-file-192"></a><a name="index-shell-init-files-193"></a>
<span class="sc">Tramp</span> checks for the availability of standard programs in the
usual locations.  Common tactics include successively trying
<samp><span class="command">test -e</span></samp>, <samp><span class="command">/usr/bin/test -e</span></samp>, and <samp><span class="command">/bin/test
-e</span></samp>.  <samp><span class="command">ls -d</span></samp> is another approach.  But these approaches do not
help with these new login patterns.

   <p>When <span class="sc">Tramp</span> encounters two-factor logins or additional challenge
questions, such as entering birth date or security code or passphrase,
<span class="sc">Tramp</span> needs a few more configuration steps to accommodate
them.

   <p>The difference between a password prompt and a passphrase prompt is
that the password for completing the login while the passphrase is
for authorizing access to local authentication information, such as
the ssh key.

   <p>There is no one configuration to accommodate all the variations in
login security, especially not the exotic ones.  However, <span class="sc">Tramp</span>
provides a few tweaks to address the most common ones.

     <dl>
<dt><code>tramp-shell-prompt-pattern</code><dd><a name="index-tramp_002dshell_002dprompt_002dpattern-194"></a>
<code>tramp-shell-prompt-pattern</code> is for remote login shell prompt,
which may not be the same as the local login shell prompt,
<code>shell-prompt-pattern</code>.  Since most hosts use identical prompts,
<span class="sc">Tramp</span> sets a similar default value for both prompts.

     <br><dt><code>tramp-password-prompt-regexp</code><br><dt><code>tramp-wrong-passwd-regexp</code><dd><a name="index-tramp_002dpassword_002dprompt_002dregexp-195"></a><a name="index-tramp_002dwrong_002dpasswd_002dregexp-196"></a>
<span class="sc">Tramp</span> uses <code>tramp-password-prompt-regexp</code> to
distinguish between prompts for passwords and prompts for passphrases. 
By default, <code>tramp-password-prompt-regexp</code> handles the
detection in English language environments.  See a localization
example below:

     <pre class="lisp">          (customize-set-variable
           'tramp-password-prompt-regexp
            (concat
             "^.*"
             (regexp-opt
              '("passphrase" "Passphrase"
                ;; English
                "password" "Password"
                ;; Deutsch
                "passwort" "Passwort"
                ;; Fran√ßais
                "mot de passe" "Mot de passe")
              t)
             ".*:\0? *"))
</pre>
     <p>Similar localization may be necessary for handling wrong password
prompts, for which <span class="sc">Tramp</span> uses <code>tramp-wrong-passwd-regexp</code>.

     <br><dt><code>tramp-terminal-type</code><dd><a name="index-tramp_002dterminal_002dtype-197"></a><a name="index-TERM_0040r_007b_002c-environment-variable_007d-198"></a>
<span class="sc">Tramp</span> uses the user option <code>tramp-terminal-type</code> to set
the remote environment variable <samp><span class="env">TERM</span></samp> for the shells it runs. 
Per default, it is &lsquo;<samp><span class="samp">"dumb"</span></samp>&rsquo;, but this could be changed.  A dumb
terminal is best suited to run the background sessions of
<span class="sc">Tramp</span>.  However, running interactive remote shells might
require a different setting.  This could be achieved by tweaking the
<samp><span class="env">TERM</span></samp> environment variable in <code>process-environment</code>.

     <pre class="lisp">          (let ((process-environment
                 (cons "TERM=xterm-256color" process-environment)))
            (shell))
</pre>
     <br><dt>Determining a <span class="sc">Tramp</span> session<dd><a name="index-TERM_0040r_007b_002c-environment-variable_007d-199"></a><a name="index-INSIDE_005fEMACS_0040r_007b_002c-environment-variable_007d-200"></a>
Sometimes, it is needed to identify whether a shell runs under
<span class="sc">Tramp</span> control.  The setting of environment variable <samp><span class="env">TERM</span></samp>
will help:

     <pre class="example">          if test "$TERM" = "dumb"; then
             ...
          fi
</pre>
     <p>Another possibility is to check the environment variable
<samp><span class="env">INSIDE_EMACS</span></samp>.  Like for all subprocesses of Emacs, this is set
to the version of the parent Emacs process, See <a href="../emacs/Interactive-Shell.html#Interactive-Shell">Interactive Shell</a>.  <span class="sc">Tramp</span> adds its own package version to this string,
which could be used for further tests in an inferior shell.  The
string of that environment variable looks always like

     <pre class="example">          echo $INSIDE_EMACS
          &rArr; 26.2,tramp:2.3.4
</pre>
     <br><dt><samp><span class="command">tset</span></samp> and other questions<dd><a name="index-unix-command-_0040command_007btset_007d-201"></a><a name="index-g_t_0040command_007btset_007d-unix-command-202"></a>
To suppress inappropriate prompts for terminal type, <span class="sc">Tramp</span>
sets the <samp><span class="env">TERM</span></samp> environment variable before the remote login
process begins via the user option <code>tramp-terminal-type</code> (see
above).  This will silence common <samp><span class="command">tset</span></samp> related prompts.

     <p><span class="sc">Tramp</span>'s strategy for handling such prompts (commonly triggered
from login scripts on remote hosts) is to set the environment
variables so that no prompts interrupt the shell initialization
process.

     <p><a name="index-tramp_002dactions_002dbefore_002dshell-203"></a>An alternative approach is to configure <span class="sc">Tramp</span> with strings
that can identify such questions using
<code>tramp-actions-before-shell</code>.  Example:

     <pre class="lisp">          (defconst my-tramp-prompt-regexp
            (concat (regexp-opt '("Enter the birth date of your mother:") t)
                    "\\s-*")
            "Regular expression matching my login prompt question.")
          
          (defun my-tramp-action (proc vec)
            "Enter \"19000101\" in order to give a correct answer."
            (save-window-excursion
              (with-current-buffer (tramp-get-connection-buffer vec)
                (tramp-message vec 6 "\n%s" (buffer-string))
                (tramp-send-string vec "19000101"))))
          
          (add-to-list 'tramp-actions-before-shell
                       '(my-tramp-prompt-regexp my-tramp-action))
</pre>
     <br><dt>Conflicting names for users and variables in <samp><span class="file">.profile</span></samp><dd>
When a user name is the same as a variable name in a local file, such
as <samp><span class="file">.profile</span></samp>, then <span class="sc">Tramp</span> may send incorrect values for
environment variables.  To avoid incorrect values, change the local
variable name to something different from the user name.  For example,
if the user name is <samp><span class="env">FRUMPLE</span></samp>, then change the variable name to
<samp><span class="env">FRUMPLE_DIR</span></samp>.

     <br><dt>Non-Bourne commands in <samp><span class="file">.profile</span></samp><dd>
When the remote host's <samp><span class="file">.profile</span></samp> is also used for shells other
than Bourne shell, then some incompatible syntaxes for commands in
<samp><span class="file">.profile</span></samp> may trigger errors in Bourne shell on the host and may
not complete client's <span class="sc">Tramp</span> connections.

     <p>One example of a Bourne shell incompatible syntax in <samp><span class="file">.profile</span></samp>:
using <samp><span class="command">export FOO=bar</span></samp> instead of <samp><span class="command">FOO=bar; export
FOO</span></samp>.  After remote login, <span class="sc">Tramp</span> will trigger an error during
its execution of <samp><span class="command">/bin/sh</span></samp> on the remote host because Bourne
shell does not recognize the export command as entered in
<samp><span class="file">.profile</span></samp>.

     <p>Likewise, (<code>~</code>) character in paths will cause errors because
Bourne shell does not do (<code>~</code>) character expansions.

     <p>One approach to avoiding these incompatibilities is to make all
commands in <samp><span class="file">~/.shrc</span></samp> and <samp><span class="file">~/.profile</span></samp> Bourne shell
compatible so <span class="sc">Tramp</span> can complete connections to that remote. 
To accommodate using non-Bourne shells on that remote, use other
shell-specific config files.  For example, bash can use
<samp><span class="file">~/.bash_profile</span></samp> and ignore <samp><span class="file">.profile</span></samp>.

     <br><dt>Interactive shell prompt<dd>
<a name="index-INSIDE_005fEMACS_0040r_007b_002c-environment-variable_007d-204"></a><a name="index-SHELLNAME_0040r_007b_002c-environment-variable_007d-205"></a><a name="index-ESHELL_0040r_007b_002c-environment-variable_007d-206"></a><span class="sc">Tramp</span> redefines the remote shell prompt internally for robust
parsing.  This redefinition affects the looks of a prompt in an
interactive remote shell through commands, such as <kbd>M-x shell
&lt;RET&gt;</kbd>.  Such prompts, however, can be reset to something more
readable and recognizable using these <span class="sc">Tramp</span> variables.

     <p><span class="sc">Tramp</span> sets the <samp><span class="env">INSIDE_EMACS</span></samp> variable in the startup
script file <samp><span class="file">~/.emacs_SHELLNAME</span></samp>.

     <p><samp><span class="env">SHELLNAME</span></samp> is <code>bash</code> or equivalent shell names.  Change it by
setting the environment variable <samp><span class="env">ESHELL</span></samp> in the <samp><span class="file">.emacs</span></samp> as
follows:

     <pre class="lisp">          (setenv "ESHELL" "bash")
</pre>
     <p>Then re-set the prompt string in <samp><span class="file">~/.emacs_SHELLNAME</span></samp> as follows:

     <pre class="example">          # Reset the prompt for remote <span class="sc">Tramp</span> shells.
          if [ "${INSIDE_EMACS/*tramp*/tramp}" == "tramp" ] ; then
             PS1="[\u@\h \w]$ "
          fi
</pre>
     <br><dt><samp><span class="command">busybox</span></samp> / <samp><span class="command">nc</span></samp><dd><a name="index-unix-command-nc-207"></a><a name="index-nc-unix-command-208"></a>
<span class="sc">Tramp</span>'s <samp><span class="option">nc</span></samp> method uses the <samp><span class="command">nc</span></samp> command to
install and execute a listener as follows (see <code>tramp-methods</code>):

     <pre class="example">          $ nc -l -p 42
</pre>
     <p>The above command-line syntax has changed with <samp><span class="command">busybox</span></samp>
versions.  If <samp><span class="command">nc</span></samp> refuses the &lsquo;<samp><span class="samp">-p</span></samp>&rsquo; parameter, then
overwrite as follows:

     <pre class="lisp">          (add-to-list
           'tramp-connection-properties
           `(,(regexp-quote "192.168.0.1")
             "remote-copy-args" (("-l") ("%r"))))
</pre>
     <p class="noindent">where &lsquo;<samp><span class="samp">192.168.0.1</span></samp>&rsquo; is the remote host IP address
(see <a href="Predefined-connection-information.html#Predefined-connection-information">Predefined connection information</a>).

   </dl>

   </body></html>

