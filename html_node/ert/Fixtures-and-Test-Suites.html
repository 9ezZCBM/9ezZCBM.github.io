<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rev="made" href="mailto:bug-gnu-emacs@gnu.org">
<link rel="icon" type="image/png" href="/graphics/gnu-head-mini.png">
<meta name="ICBM" content="42.256233,-71.006581">
<meta name="DC.title" content="gnu.org">

<title>Fixtures and Test Suites - Emacs Lisp Regression Testing</title>
<!--
Copyright (C) 2008, 2010--2019 Free Software Foundation, Inc.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License''.

     (a) The FSF's Back-Cover Text is: ``You have the freedom to copy
     and modify this GNU manual.''
   -->
<style type="text/css">
@import url('/software/emacs/manual.css');
</style>
</head>
<body>
<div class="node" style="background-color:#DDDDFF">
<a name="Fixtures-and-Test-Suites"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Mocks-and-Stubs.html#Mocks-and-Stubs">Mocks and Stubs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Other-Testing-Concepts.html#Other-Testing-Concepts">Other Testing Concepts</a>

</div>

<h3 class="section">6.2 Fixtures and Test Suites</h3>

<p><a name="index-fixtures-53"></a>
In many ways, ERT is similar to frameworks for other languages like
SUnit or JUnit.  However, two features commonly found in such
frameworks are notably absent from ERT: fixtures and test suites.

   <p>Fixtures are mainly used (e.g., in SUnit or JUnit) to provide an
environment for a set of tests, and consist of set-up and tear-down
functions.

   <p>While fixtures are a useful syntactic simplification in other
languages, this does not apply to Lisp, where higher-order functions
and <code>unwind-protect</code> are available.  One way to implement and use a
fixture in ERT is

<pre class="lisp">     (defun my-fixture (body)
       (unwind-protect
           (progn [set up]
                  (funcall body))
         [tear down]))
     
     (ert-deftest my-test ()
       (my-fixture
        (lambda ()
          [test code])))
</pre>
   <p>(Another way would be a <code>with-my-fixture</code> macro.)  This solves
the set-up and tear-down part, and additionally allows any test
to use any combination of fixtures, so it is more flexible than what
other tools typically allow.

   <p>If the test needs access to the environment the fixture sets up, the
fixture can be modified to pass arguments to the body.

   <p>These are well-known Lisp techniques.  Special syntax for them could
be added but would provide only a minor simplification.

   <p>(If you are interested in such syntax, note that splitting set-up and
tear-down into separate functions, like *Unit tools usually do, makes
it impossible to establish dynamic <code>let</code> bindings as part of the
fixture.  So, blindly imitating the way fixtures are implemented in
other languages would be counter-productive in Lisp.)

   <p>The purpose of test suites is to group related tests together.

   <p>The most common use of this is to run just the tests for one
particular module.  Since symbol prefixes are the usual way of
separating module namespaces in Emacs Lisp, test selectors already
solve this by allowing regexp matching on test names; e.g., the
selector <code>"^ert-"</code> selects ERT's self-tests.

   <p>Other uses include grouping tests by their expected execution time,
e.g., to run quick tests during interactive development and slow tests less
often.  This can be achieved with the <code>:tag</code> argument to
<code>ert-deftest</code> and <code>tag</code> test selectors.

   </body></html>

